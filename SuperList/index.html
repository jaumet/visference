<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>New Web Project</title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
        <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="js/jquery.tablesorter.js"></script>
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <script type="text/javascript" src="data/my.json"></script>
        <script>
        $(document).ready(function() {
        	function count(){
				var vis = $("#myTable tr").filter(':visible').length -1;
				$("#counter").html(vis);
			}
	        var isInteger = function(a) {
			    return ((typeof a !== 'number') || (a % 1 !== 0)) ? false : true;
			};
			
	        thead = '<thead class="header"><tr id="header"><th>ID</th><th>title</th><th>Topic 1</th><th>Topic 2</th><th>Topic 3</th><th>Topic 4</th><th>Topic 5</th></tr></thead>'; 
        	
        	//$.getJSON("data/my.json", function(data){
				var items = [thead];
				var it = ''; var circle;var nclass='';
				$.each(DATA, function(key1, val1) {
					$.each(val1, function(key, val) {
						if (key == "title" || key == "id") {
							circle = val;
						}
						else if (key.substring(0,4) === "axis") {
							nclass = nclass + ' ' + val;
						}
						else if (key.substring(0,5) === "topic") {
							circle = '<span class="circle" style="color:transparent;height:'+(val/4)+'px;width:'+(val/4)+'px;">'+val+'</span>';
						}
					  	if (key.substring(0,4) !== "axis") {
					  		it = it +'<td>' + circle + '</td>';
					  		nclass = ''; 
				  		}
				  	});
					items.push('<tr class="' + nclass + '">' + it + '</tr>');
					it = ''; nclass='';
				});
				$('<table/>', {
				    'class': 'tablesorter',
				    'id': 'myTable',
				    html: items.join('')
				}).appendTo('#list');
				$("#myTable")
					.tablesorter({ 
						sortList: [[0,0]]
	  		        });
				count();
				$("#myTable tr td:nth-child(2)").addClass("tatbletitle");
			//});

			/////////////////////////////////
			// Getting axis list from JSON //
			//$.getJSON("data/filters.json", function(data){
				var items = [''];
				$.each(FILTERS, function(key1, val1) {
					var myaxis = ''; var myval = '';var myname = '';
					$.each(val1, function(key, val) {
						if (key == "axisname") 
						{
							myaxis = '<span class="btn btp-mini btn-inverse" style="cursor:default;border-right:0px solid white;width:150px;height:20px;">'+val+'</span><br />';
						} else {
							$.each(val, function(key2, val2) {
								$.each(val2, function(key3, val3) {
									if (key3 == "code") {
										// Counting papers for this axes value:
										var c = $("#myTable tr\."+val3).length;
										if (c > 0) {
											myname = '<span class="checkbox btn btn-mini"><input type="checkbox" class="checked '+val3+'" />('+c;
										}
									} else {
										if (myname.length>1) {
											myval =  myval  +  myname +') '+ val3 +'</span>';
											myname = '';
										}
									}
								});
							});
						}
					});
					items.push('<p>' + myaxis + myval + '</p>');
				});
				$('<div/>', {
				    'class': 'my',
				    'id': 'myFilter',
				    html: items.join('')
				}).appendTo('#filters');
	
				/////////////
				// Filters //
				$('input').click(function(){
					// Array of all filters:
					var allfilters = new Array();
					$('#myFilter p span.checkbox input').each(function() {
						allfilters.push($(this).attr('class').substring(8));
					});
					// Array of checked filter's checkboxes:
					var selected = new Array();
					$('#myFilter p span.checkbox input:checked').each(function() {
						selected.push("."+$(this).attr('class').substring(8));
					});
					selected.sort();
					console.log ("selected filters: "+selected);
					
					//////////////////////////////////////////////////////////
					// Starting the functions to get the selector of filters
					
					// The function to get the category of a particular subcategory
					function getCategory(subCat){
						return subCat.substr(1, 1);
					}

					// The function to build our selector recursively
					function buildSelector(categoryList, categoryIndexArray, categoryIndex)
					{
						if (categoryIndex == categoryIndexArray.length - 1)
							return categoryList[categoryIndexArray[categoryIndex]];
						else {
							var results = [];
							var subList = buildSelector(categoryList, categoryIndexArray, categoryIndex + 1);
							$.each(categoryList[categoryIndexArray[categoryIndex]],function(_,e){
								$.each(subList,function(_,e1){
									results.push(e + e1);
								});
							});
							return results;
						}
					}
					var categories = {}; 
					var categoryArray = [];
					// build the categories and categoryArray 
					$.each(selected,function(_,e){
						var cat = getCategory(e);
						if (categories[cat] === undefined)
						{
							categories[cat] = [];
							categoryArray.push(cat);
						}
						if (categories[cat].indexOf(e) < 0)
							categories[cat].push(e);
					});
					// build our selector as array of groups
					var selectors = buildSelector(categories, categoryArray, 0);
					// join all selector groups to get the string form
					console.log(selectors.join(","));
					// Finally the Selector list is here:
					var xclass = selectors.join(",");
					
					// End of functions to get the selctor of filters
					////////////////////////////////////////////////////////
					//
					// HERE WE NEED TO IMPLEMENT THE RECOUNTING OF VISIBLE 
					// ITEMS AND ADD THEM LIVE TO THE <SPAN> OF FILTERS
					//
					//  (the number needs a specific class name to be 
					//  accessible easily)
					//
					///////////////////////////////////////////////////////
					
					
					var myclass = this.className.substring(8);
					$('#myTable tr').hide();
					$('#myTable tr:first').show();
					$('#myTable tr'+xclass).show("slow");

					myblue = $('input.'+myclass).parent('span');
					if ($(this).is(':checked')) {
						myblue.addClass('btn-primary');						
					} else {
						myblue.removeClass('btn-primary');
					}
					
					$('#myTable tr'+sel).promise().done(function(){
						count();
					});
				});
				
				$('#showall').click(function(){
					$('#myTable tr').show("slow");
					$('#myTable tr').promise().done(function(){
						count();
						$('input').parent('span').addClass('btn-primary');
						$('input').prop('checked', true);
					});
				});
			});
			$('#showhidefilters').click(function() {
				$('#filters').toggle("slow");
			});
		//});
        </script>
        <style>
		body {
		  padding-top: 60px;
		  padding-bottom: 40px;
		}
		.circle {
		  background-color:orange;
		  background-position:initial initial;
		  background-repeat:initial initial;
		  border-bottom-left-radius:50%;
		  border-bottom-right-radius:50%;
		  border-top-left-radius:50%;
		  border-top-right-radius:50%;
		  display:inline-block;
		  margin-top:2px;
		  margin-bottom:2px;
		  color:black;
		}
		#countercontainer {
  		  background-color:grey;
		  background-position:initial initial;
		  background-repeat:initial initial;
		  border-bottom-left-radius:20%;
		  border-bottom-right-radius:20%;
		  border-top-left-radius:20%;
		  border-top-right-radius:20%;
		  display:inline-block;
		  padding:7px;
		  text-align:center;
		  }
		#counter {
		  color:#ffffff;
		  font-size:70px;
		}
		#tablecontainer {
			position:relative;
			float:left;
			width:70%;
			padding-left:30px;
		}
		td {
		  text-align:center;
		}
		.tatbletitle {
		   text-align:left;
		}
		.hero-unit {
			padding:0;
			padding-top:0;
			background-color:#EFEFEF;
		}
		.container:after {
			clear:none;
		}
		.my {
			padding:0;
		}
		#right {
			position:relative;
			float:right;
			width:100px;
			font-size:14px;
		}
		#right p {
			text-align:center;
		}
		.checkbox {
			/*float:left;*/
			border:0px solid grey;
			margin-left:4px;
			padding-left:25px;
			/*width: 150px;*/
		}
		#title {
			padding-left:20px;
			position:relative;
			float:left;
		}
        </style>
        <link href="css/style.css" rel="stylesheet">
    </head>
    <body>
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="brand" href="#">Visference</a>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="active"><a href="#">Home</a></li>
						<li><a href="#about">About</a></li>
						<li><a href="#contact">Contact</a></li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
							<ul class="dropdown-menu">
								<li><a href="#">Action</a></li>
								<li><a href="#">Another action</a></li>
								<li><a href="#">Something else here</a></li>
								<li class="divider"></li>
								<li class="nav-header">Nav header</li>
								<li><a href="#">Separated link</a></li>
								<li><a href="#">One more separated link</a></li>
							</ul>
						</li>
					</ul>
					<form class="navbar-form pull-right">
						<input class="span2" type="text" placeholder="Email">
						<button type="submit" class="btn">Suscribe</button>
					</form>
				</div><!--/.nav-collapse -->
			</div>
		</div>
	</div>
	
	<div class="container">
		<!-- Main hero unit for a primary marketing message or call to action -->
		<div style="position:relative;">
			
			<div id="right">
				<p> Showing</p>
				<div id="countercontainer">
					<br />
					<span id="counter">
					</span>
				</div>
				<p>papers</p>
			</div>	
		</div>
		<p><img src="http://jmlr.org/jmlr.jpg" width="120px" /></p>
		<p><a href="#" id="showhidefilters" class="btn btn-primary">show/hide filters</a></p>
		<div class="hero-unit"  data-spy="affix" style="position:relative;float:left;width:15%;">
		<p>Filter papers by:</p>
		<p id="myp"><a href="#" id="showall" class="btn btn-primary"/>show all</a></p>
		<div id="filters">
		</div>
		</div>
	</div>
	<!--<div style="clear:both;"></div>-->
	<!--Post bootstrap-->
	<div id="title"><h2>JRML Volume 13</h2>
	</div>
	<div id="tablecontainer">
		<h3>List of papers</h3>
		<div id="list">
		</div>
	</div>
	<hr>
	<footer>
		<!--<p>&copy; jmlr 2013</p>-->
	</footer>
    </body>
</html>
